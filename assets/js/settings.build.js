(function(){"use strict";function v(e,d){let u=e.split("?");if(u.length>=2){let b=encodeURIComponent(d)+"=",f=u[1].split(/[&;]/g);for(var p=f.length;p-- >0;)f[p].lastIndexOf(b,0)!==-1&&f.splice(p,1);return u[0]+(f.length>0?"?"+f.join("&"):"")}return e}jQuery(document).ready(function(e){e(".ep-color-picker").wpColorPicker();let d=!1,u=e(".embedpress-settings-form"),p=e(".embedpress-settings-form :input:not([type=submit], [disabled], button, [readonly])");p.on("change",function(o){d=!1;let t=["ep_settings_nonce","_wp_http_referer","g_loading_animation","submit"],n=["button"],a=["yt_branding","embedpress_document_powered_by","embedpress_pro_twitch_autoplay","embedpress_pro_twitch_chat"],s=[];for(var r=0;r<p.length;r++){let i=p[r],c=i.type,m=i.name;if(!t.includes(m)&&!n.includes(c)){let l=e(i);if(c==="radio"){if(!s.includes(m)){let C=e(`input[name="${m}"]:checked`),g=C.parents(".input__radio_wrap"),S=C.val();g.data("value",S),g.data("value")!=g.data("default")&&(d=!0),s.push(m)}}else c==="checkbox"?(l.is(":checked")?l.data("value",l.val()):a.includes(m)?l.data("value","no"):l.data("value",""),l.data("value")!=l.data("default")&&(d=!0)):l.val()!=l.data("default")&&(d=!0)}}d===!0?u.find(".embedpress-submit-btn").addClass("ep-settings-form-changed"):u.find(".embedpress-submit-btn").removeClass("ep-settings-form-changed")}),window.onbeforeunload=function(){if(d===!0)return"You have unsaved data. Are you sure to leave without saving them?"},e(".sidebar__dropdown .sidebar__link--toggler").on("click",function(o){o.preventDefault();let t=e(this),n=e(".sidebar__item");n.removeClass("show"),t.parent().addClass("show"),t.siblings(".dropdown__menu").hasClass("show")?(t.siblings(".dropdown__menu").removeClass("show"),t.siblings(".dropdown__menu").slideUp(),n.removeClass("show")):(e(".dropdown__menu.show").slideUp().removeClass("show"),t.siblings(".dropdown__menu").addClass("show"),t.siblings(".dropdown__menu").slideDown())}),e(".sidebar__toggler").on("click",function(o){o.preventDefault(),e(this).siblings(".sidebar__menu").slideToggle()}),e(".preview__remove").on("click",function(o){o.preventDefault();let n=e(this).parents(".logo__adjust__wrap");n.find(".preview__logo").attr("src",""),n.find(".logo__upload__preview").hide(),n.find(".logo__upload").show(),n.find(".instant__preview__img").attr("src",""),n.find(".preview__logo__input").val(""),n.find(".preview__logo__input_id").val(""),u.find(".embedpress-submit-btn").addClass("ep-settings-form-changed"),d=!0}),function(){e(".logo__adjust").each(function(){let t=e(this),n=t.find(".preview__logo"),a=t.find(".opacity__range"),s=t.find(".x__range"),r=t.find(".y__range"),i=t.find(".range__value");i.each(function(){e(this).html(e(this).prev().attr("value"))}),a.on("input",function(){e(this).next(i).val(this.value),n.css("opacity",this.value/100)}),s.on("input",function(){e(this).next(i).val(this.value),n.css("right",this.value+"%")}),r.on("input",function(){e(this).next(i).val(this.value),n.css("bottom",this.value+"%")})})}(),e(".template__wrapper .input__switch .logo__adjust__toggler").on("click",function(o){o.preventDefault(),e(".logo__adjust__wrap").not(e(this).parents(".form__control__wrap").children(".logo__adjust__wrap")).slideUp(),e(".template__wrapper .input__switch .logo__adjust__toggler").not(e(this)).removeClass("show"),e(this).toggleClass("show"),e(this).parents(".form__control__wrap").children(".logo__adjust__wrap").slideToggle()}),e(".form__control__wrap .input__switch input").on("click",function(){e(this).siblings(".logo__adjust__toggler.show").trigger("click")}),function(){e(document).on("click",".isPro",function(){e(this).siblings(".pro__alert__wrap").fadeIn()}),e(document).on("click",".pro__alert__card .button",function(o){o.preventDefault(),e(this).parents(".pro__alert__wrap").fadeOut()})}(),e(document).on("click",".logo__upload",function(o){o.preventDefault();let t=e(this),n=t.parent(".logo__adjust__wrap"),a=n.find(".preview__logo"),s=n.find(".logo__upload__preview"),r=n.find(".instant__preview__img"),i=n.find(".preview__logo__input"),c=n.find(".preview__logo__input_id");e(this);let m=wp.media({title:"Custom Logo",library:{uploadedTo:wp.media.view.settings.post.id,type:"image"},button:{text:"Use this image"},multiple:!1}).on("select",function(){let l=m.state().get("selection").first().toJSON();l&&l.id&&l.url?(t.hide(),i.val(l.url),c.val(l.id),r.attr("src",l.url),s.show(),a.attr("src",l.url),u.find(".embedpress-submit-btn").addClass("ep-settings-form-changed"),d=!0):console.log("something went wrong using selected image")}).open()}),e(document).on("change",".element-check",function(o){let t=e(this);e.ajax({url:ajaxurl,type:"post",data:{action:"embedpress_elements_action",_wpnonce:embedpressObj.nonce,element_type:t.data("type"),element_name:t.data("name"),checked:t.is(":checked")},success:function(n){n&&n.success?w():h()},error:function(n){h()}})}),e(document).on("submit","form.embedpress-settings-form",function(o){o.preventDefault();let t=e(this),n=t.find(".embedpress-submit-btn"),a=n.text();const s=t.serializeArray(),r=n.attr("value");n.text("Saving...");const i={name:"action",value:"embedpress_settings_action"};s.push(i),s.push({name:"submit",value:r}),e.ajax({url:ajaxurl,type:"post",dataType:"json",data:s,success:function(c){n.removeClass("ep-settings-form-changed"),c&&c.success?(w(),n.text(a),d=!1):(n.text(a),h())},error:function(c){n.removeClass("ep-settings-form-changed"),n.text(a),h()}})});function w(){let o=e(".toast__message--success");o.addClass("show"),setTimeout(function(){o.removeClass("show")},3e3)}function h(){let o=e(".toast__message--error");o.addClass("show"),setTimeout(function(){o.removeClass("show")},3e3)}e(document).on("click",".embedpress-license-deactivation-btn",function(o){let t=e(this);setTimeout(function(){t.attr("disabled","disabled")},2e3),t.html("Deactivating.....")}),e(document).on("click",".embedpress-license-activation-btn",function(o){let t=e(this);e("#embedpress-pro-license-key").val()&&(setTimeout(function(){t.attr("disabled","disabled")},2e3),t.html("Activating....."))});function y(o){if(window.clipboardData&&window.clipboardData.setData)return window.clipboardData.setData("Text",o);if(document.queryCommandSupported&&document.queryCommandSupported("copy")){var t=document.createElement("textarea");t.textContent=o,t.style.position="fixed",document.body.appendChild(t),t.select();try{return document.execCommand("copy")}catch(n){return console.warn("Copy to clipboard failed.",n),!1}finally{document.body.removeChild(t)}}}function k(o){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(o)}let _=e("#ep-shortcode");e(document).on("click","#ep-shortcode-btn",function(o){o.preventDefault();let t=e("#ep-link"),n=t.val();if(!k(n)){x("Please enter a valid URL."),t.val(""),_.val("");return}t.val("");var a=n.split(".");a[a.length-1]==="pdf"?_.val("[embedpress_pdf]"+n+"[/embedpress_pdf]"):_.val("[embedpress]"+n+"[/embedpress]"),_.focus()}),e(document).on("click","#ep-shortcode-cp",function(o){o.preventDefault();let t=_.val();if(t.length<1){j("Please enter a valid URL and generate a shortcode first.");return}y(t),_.removeClass("active"),D("Copied to your clipboard successfully.")}),_.on("focus",function(o){e(this).select()});function x(o=""){let t=e(".toast__message--attention");o.length>0&&t.find("p").html(o),t.addClass("show"),setTimeout(function(){t.removeClass("show"),history.pushState("","",v(location.href,"attention"))},3e3)}function j(o=""){let t=e(".toast__message--error");o.length>0&&t.find("p").html(o),t.addClass("show"),setTimeout(function(){t.removeClass("show"),history.pushState("","",v(location.href,"error"))},3e3)}function D(o=""){let t=e(".toast__message--success");o.length>0&&t.find("p").html(o),t.addClass("show"),setTimeout(function(){t.removeClass("show"),history.pushState("","",v(location.href,"success"))},3e3)}function T(o,t,n){const a=document.createElement("div");a.classList.add("custom-dialog");const s=document.createElement("p");s.textContent=o;const r=document.createElement("button");r.textContent="Yes",r.addEventListener("click",()=>{document.body.removeChild(a),t()});const i=document.createElement("button");i.textContent="No",i.addEventListener("click",()=>{document.body.removeChild(a),n()}),a.appendChild(s),a.appendChild(r),a.appendChild(i),document.body.appendChild(a)}e(".account-delete-button").on("click",function(){T("Are you sure you want to delete?",o,t),$that=e(this),$userId=$that.closest("tr").data("userid"),$accountType=$that.closest("tr").data("accounttype"),$that.css("pointer-events","none");function o(){var n={action:"delete_instagram_account",user_id:$userId,account_type:$accountType,_nonce:embedpressObj.nonce};jQuery.post(ajaxurl,n,function(a){console.log(a),a&&($that.css("pointer-events","all"),$that.closest("tr").remove())})}function t(){$that.css("pointer-events","all"),console.log("Deletion cancelled.")}}),e("#instagram-form").on("submit",function(o){o.preventDefault(),e("#instagram-form p").length>0&&e("#instagram-form p").remove();var t=e("#instagram-access-token").val(),n=e("#account-option").val();e("#instagram-form button").text("Connecting..."),e("#instagram-form button").attr("disabled","disabled"),e.ajax({url:ajaxurl,type:"POST",data:{action:"get_instagram_userdata_ajax",access_token:t,account_type:n,_nonce:embedpressObj.nonce},success:function(a){console.log(a),a.error?(e("#instagram-form button").text("Connect"),e("#instagram-access-token").after(`<p>${a.error}</p>`),e("#instagram-form button").removeAttr("disabled"),setTimeout(()=>{e("#instagram-form p").remove()},1e4)):(e("#instagram-form button").text("Connected"),setTimeout(()=>{window.location.reload()},1e3))},error:function(a,s,r){console.error(r)}})}),e(".instagram-sync-data").on("click",function(o){o.preventDefault(),$that=e(this);var t=$that.data("acceess-token"),n=$that.data("account-type"),a=$that.data("userid");$that.find("i").addClass("sync-spin"),$that.attr("disabled","disabled"),e.ajax({url:ajaxurl,type:"POST",data:{action:"sync_instagram_data_ajax",access_token:t,account_type:n,user_id:a,_nonce:embedpressObj.nonce},success:function(s){console.log(s),s.error?$that.removeAttr("disabled"):($that.removeClass("sync-spin"),$that.text("Synced."),setTimeout(()=>{window.location.reload()},1e3))},error:function(s,r,i){console.error(i)}})}),e(".calendly-event-copy-link").click(function(){var o=e(this).data("event-link"),t=e("<input>");e("body").append(t),t.val(o).select(),document.execCommand("copy"),t.remove();var n=e(this);n.find("span").text("Copied!"),setTimeout(function(){n.find("span").text("Copy link")},1500)}),e("#open-modal-btn").click(function(){e(".modal-overlay").css("display","block")}),e(".modal-overlay .close-btn").click(function(){e(".modal-overlay").css("display","none")}),e(document).on("click",function(o){o.target.classList.contains("modal-overlay")&&e(".modal-overlay").css("display","none")}),e(".user-profile-link").click(function(){var o=e(this).attr("title");y(o),alert("Link copied to clipboard: "+o)}),e(document).on("click",".popup-video-wrap, .close-video_btn",function(o){o.preventDefault(),e(".popup-video").remove(),e(".popup-video-wrap").removeClass("popup-active")}),e(".video-play_btn").click(function(o){e(".popup-video-wrap").append(`
                <div class="popup-video">
                    <button class="close-video_btn">
                        <a href="#" class="close-btn"></a>
                    </button>
                   <iframe src="https://www.youtube.com/embed/fvYKLkEnJbI?autoplay=1" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen>
                    </iframe>

                </div>
            `)})})})();
