var L=Object.defineProperty,U=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var _=(c,n,r)=>n in c?L(c,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[n]=r,T=(c,n)=>{for(var r in n||(n={}))V.call(n,r)&&_(c,r,n[r]);if(y)for(var r of y(n))q.call(n,r)&&_(c,r,n[r]);return c},I=(c,n)=>U(c,P(n));var k=(c,n,r)=>new Promise((u,w)=>{var m=d=>{try{p(r.next(d))}catch(l){w(l)}},g=d=>{try{p(r.throw(d))}catch(l){w(l)}},p=d=>d.done?u(d.value):Promise.resolve(d.value).then(m,g);p((r=r.apply(c,n)).next())});(function(){"use strict";(function(){function c(){const t="ep_session_id";let e=sessionStorage.getItem(t);return e||(e="ep-"+Date.now()+"-"+Math.random().toString(36).substring(2,10),sessionStorage.setItem(t,e)),e}const n={viewThreshold:49,viewDuration:3e3,viewResetCooldown:6e4,impressionCooldown:5e3,debug:!1,restUrl:(embedpress_analytics==null?void 0:embedpress_analytics.rest_url)||"/wp-json/embedpress/v1/analytics/",sessionId:c(),pageUrl:(embedpress_analytics==null?void 0:embedpress_analytics.page_url)||window.location.href,postId:(embedpress_analytics==null?void 0:embedpress_analytics.post_id)||0,ipLocationData:null},r=new Map,u={viewedContent:new Set,clickedContent:new Set,impressedContent:new Map},w=new IntersectionObserver(t=>{t.forEach(e=>{const o=e.target,i=r.get(o);if(!i)return;let s=Math.floor(e.intersectionRatio*100);if(s<n.viewThreshold&&e.isIntersecting){const a=e.boundingClientRect,v=window.innerHeight,h=window.innerWidth,E=Math.min(a.bottom,v)-Math.max(a.top,0),O=Math.min(a.right,h)-Math.max(a.left,0);E*O/(v*h)*100>=30&&(s=Math.max(s,n.viewThreshold))}i.viewportPercentage=s,i.inViewport=e.isIntersecting,e.isIntersecting&&m(o,i),g(o,i,s)})},{threshold:Array.from({length:11},(t,e)=>e/10)});function m(t,e){const o=Date.now(),i=u.impressedContent.get(e.contentId)||0;o-i<n.impressionCooldown||(u.impressedContent.set(e.contentId,o),e.lastImpressionTime=o,b({content_id:e.contentId,interaction_type:"impression",interaction_data:{embed_type:e.embedType,embed_url:e.embedUrl,viewport_percentage:e.viewportPercentage,location_data:n.ipLocationData}}))}function g(t,e,o){if(!e.inViewport||o<n.viewThreshold){e.viewTimer&&(clearTimeout(e.viewTimer),e.viewTimer=null);return}const i=Date.now();e.viewTracked&&i-(e.lastViewTime||0)>n.viewResetCooldown&&(e.viewTracked=!1),!(e.viewTracked||u.viewedContent.has(e.contentId))&&(e.viewTimer||(e.viewTimer=setTimeout(()=>{p(t,e),e.viewTracked=!0,e.lastViewTime=Date.now(),u.viewedContent.add(e.contentId),e.viewTimer=null},n.viewDuration)))}function p(t,e){b({content_id:e.contentId,interaction_type:"view",interaction_data:{embed_type:e.embedType,embed_url:e.embedUrl,viewport_percentage:e.viewportPercentage,view_duration:n.viewDuration}})}function d(){r.forEach((t,e)=>{e.addEventListener("click",()=>{u.clickedContent.has(t.contentId)||(u.clickedContent.add(t.contentId),b({content_id:t.contentId,interaction_type:"click",interaction_data:{embed_type:t.embedType,embed_url:t.embedUrl}}))})})}function l(t){if(r.has(t))return;const e=t.getAttribute("data-embed-type");if(!e)return;let o=t.getAttribute("data-embedpress-content")||t.getAttribute("data-source-id")||t.getAttribute("data-emid")||"ep-"+e+"-"+Math.random().toString(36).substring(2,10);t.setAttribute("data-embedpress-content",o);const i={contentId:o,embedType:e,embedUrl:C(t),inViewport:!1,viewTimer:null,viewTracked:!1,lastImpressionTime:0,lastViewTime:0,viewportPercentage:0};r.set(t,i),w.observe(t)}function C(t){const e=t.querySelector("iframe"),o=t.querySelector("video source"),i=t.querySelector("audio source"),s=t.querySelector("embed"),a=t.querySelector("object");return(e==null?void 0:e.src)||(o==null?void 0:o.src)||(i==null?void 0:i.src)||(s==null?void 0:s.src)||(a==null?void 0:a.data)||t.getAttribute("data-url")||t.getAttribute("data-src")||t.getAttribute("href")||""}function S(){document.querySelectorAll("[data-embed-type]").forEach(l)}function D(){if(!("MutationObserver"in window))return;new MutationObserver(e=>{e.forEach(o=>{o.addedNodes.forEach(i=>{var s,a;i.nodeType===1&&((s=i.getAttribute)!=null&&s.call(i,"data-embed-type")&&l(i),(a=i.querySelectorAll)==null||a.call(i,"[data-embed-type]").forEach(l))})})}).observe(document.body,{childList:!0,subtree:!0})}function b(t){var o;if(!((o=t.interaction_data)!=null&&o.embed_type)||t.interaction_data.embed_type==="unknown"||t.interaction_data.embed_type==="")return;const e=I(T({},t),{session_id:n.sessionId,page_url:n.pageUrl,post_id:n.postId});fetch(n.restUrl+"track",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":(embedpress_analytics==null?void 0:embedpress_analytics.nonce)||""},body:JSON.stringify(e),credentials:"same-origin"}).catch(i=>{if(navigator.sendBeacon){const s=new Blob([JSON.stringify(e)],{type:"application/json"});navigator.sendBeacon(n.restUrl+"track",s)}})}function A(){return k(this,null,function*(){try{const e=yield(yield fetch("https://ipinfo.io/json")).json();n.ipLocationData={country:e.country,city:e.city,timezone:e.timezone,source:"ip"}}catch(t){return null}})}function M(){const t={session_id:n.sessionId,screen_resolution:window.screen.width+"x"+window.screen.height,language:navigator.language,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,user_agent:navigator.userAgent};A().then(()=>{n.ipLocationData&&(t.country=n.ipLocationData.country,t.city=n.ipLocationData.city),fetch(n.restUrl+"browser-info",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":(embedpress_analytics==null?void 0:embedpress_analytics.nonce)||""},body:JSON.stringify(t),credentials:"same-origin"})})}function f(){S(),d(),D(),M()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",f):f()})()})();
