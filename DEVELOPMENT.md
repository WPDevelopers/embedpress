# EmbedPress Development Guide

## Optimized Script Management

This guide explains the optimized build system for EmbedPress frontend development.

## Architecture Overview

```
embedpress/
├── src/                          # React-based components (Vite builds these)
│   ├── Blocks/                   # Gutenberg blocks (React)
│   ├── AdminUI/                  # Admin dashboard (React SPA)
│   ├── Frontend/                 # Frontend analytics & interactions (Vanilla JS)
│   └── Shared/                   # Shared components, hooks, utils
├── EmbedPress/                   # PHP-based components (WordPress handles these)
│   ├── Elementor/                # Elementor widgets (PHP)
│   ├── Shortcode.php             # Shortcodes (PHP)
│   └── ...                       # Other PHP functionality
└── assets/                       # Built files (generated by Vite)
    ├── js/                       # JavaScript builds
    └── css/                      # CSS builds
```

## Build Targets

The build system supports three main targets:

### 1. Blocks (`blocks`)
- **Source**: `src/Blocks/index.js`
- **Output**: `assets/js/blocks.build.js`, `assets/css/blocks.style.build.css`
- **Purpose**: Gutenberg block editor and frontend functionality
- **Dependencies**: WordPress externals (wp.blocks, wp.element, etc.)

### 2. Admin (`admin`)
- **Source**: `src/AdminUI/index.js`
- **Output**: `assets/js/admin.build.js`, `assets/css/admin.build.css`
- **Purpose**: React-based admin dashboard
- **Dependencies**: React, ReactDOM, jQuery

### 3. Frontend (`frontend`)
- **Source**: `src/Frontend/index.js`
- **Output**: `assets/js/frontend.build.js`, `assets/css/frontend.build.css`
- **Purpose**: Frontend analytics, interactions, and enhancements
- **Dependencies**: jQuery (optional)

## Development Commands

### Development Mode (with HMR)
```bash
# Start development for specific target
npm run dev:blocks      # Gutenberg blocks
npm run dev:admin       # Admin dashboard
npm run dev:frontend    # Frontend scripts

# Start development for all targets (default)
npm run dev             # Starts blocks development
```

### Watch Mode (auto-rebuild on changes)
```bash
# Watch specific target
npm run watch:blocks    # Watch blocks only
npm run watch:admin     # Watch admin only
npm run watch:frontend  # Watch frontend only

# Watch all targets simultaneously
npm run watch:all       # Watches all targets
npm start              # Alias for watch:all
```

### Production Build
```bash
# Build specific target
npm run build:blocks    # Build blocks + split CSS
npm run build:admin     # Build admin dashboard
npm run build:frontend  # Build frontend scripts

# Build all targets
npm run build:all       # Builds everything
npm run build          # Alias for build:all
```

## File Organization

### Shared Components (`src/Shared/`)
```
Shared/
├── components/         # Reusable React components
├── hooks/             # Custom React hooks
├── utils/             # Utility functions
├── stores/            # State management (Zustand)
├── services/          # API services
├── types/             # TypeScript types
└── styles/            # SCSS variables and mixins
```

### Path Aliases
The build system includes convenient path aliases:

```javascript
import { Button } from '@components/Button';
import { useAnalytics } from '@hooks/useAnalytics';
import { trackEvent } from '@utils/analytics';
import { useStore } from '@stores/analytics';
```

Available aliases:
- `@` → `src/`
- `@components` → `src/Shared/components`
- `@hooks` → `src/Shared/hooks`
- `@utils` → `src/Shared/utils`
- `@stores` → `src/Shared/stores`
- `@services` → `src/Shared/services`
- `@types` → `src/Shared/types`
- `@assets` → `assets/`
- `@blocks` → `src/Blocks`
- `@admin` → `src/AdminUI`
- `@frontend` → `src/Frontend`

## CSS Management

### SCSS Support
- All targets support SCSS out of the box
- Shared variables are automatically imported: `@import "@/Shared/styles/variables.scss"`
- CSS is automatically split into editor and frontend files for blocks

### CSS Output
- **Blocks**: Automatically split into `blocks.editor.build.css` and `blocks.style.build.css`
- **Admin**: Single file `admin.build.css`
- **Frontend**: Single file `frontend.build.css`

## Best Practices

### 1. Component Organization
```javascript
// ✅ Good: Use shared components
import { Button } from '@components/Button';
import { Modal } from '@components/Modal';

// ❌ Avoid: Duplicating components across targets
```

### 2. State Management
```javascript
// ✅ Good: Use Zustand for global state
import { useAnalyticsStore } from '@stores/analytics';

// ✅ Good: Use React hooks for local state
import { useState, useEffect } from 'react';
```

### 3. Styling
```scss
// ✅ Good: Use shared variables
.my-component {
    color: var(--ep-primary-color);
    padding: $spacing-md;
}

// ✅ Good: Use BEM methodology
.embedpress-block {
    &__header { }
    &__content { }
    &--loading { }
}
```

### 4. TypeScript
```typescript
// ✅ Good: Use proper types
interface AnalyticsEvent {
    type: string;
    data: Record<string, any>;
    timestamp: number;
}

// ✅ Good: Export types for reuse
export type { AnalyticsEvent };
```

## Debugging

### Development Tools
- **Vite Dev Server**: `http://localhost:3000` (when running dev mode)
- **HMR**: Hot module replacement for instant updates
- **Source Maps**: Available in development mode
- **React DevTools**: Works with admin dashboard

### Build Analysis
```bash
# Analyze bundle size
npm run build:admin -- --analyze

# Check for unused dependencies
npm run lint

# Type checking
npm run type-check
```

## Integration with WordPress

### Enqueueing Assets
The PHP side handles asset enqueueing:

```php
// Blocks are enqueued by Gutenberg integration
wp_enqueue_script('embedpress-blocks', EMBEDPRESS_URL_ASSETS . 'js/blocks.build.js');

// Admin is enqueued on admin pages
wp_enqueue_script('embedpress-admin', EMBEDPRESS_URL_ASSETS . 'js/admin.build.js');

// Frontend is enqueued on public pages
wp_enqueue_script('embedpress-frontend', EMBEDPRESS_URL_ASSETS . 'js/frontend.build.js');
```

### WordPress Externals
WordPress dependencies are externalized to avoid bundling:
- `wp.blocks`, `wp.element`, `wp.components`, etc. are loaded from WordPress core
- React and ReactDOM are loaded from WordPress or CDN
- jQuery is loaded from WordPress core

This keeps bundle sizes small and ensures compatibility.
